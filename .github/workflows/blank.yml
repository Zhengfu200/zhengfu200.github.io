name: Fetch Open Issues

on:
  schedule:
    - cron: '0 * * * *'  # æ¯å°æ—¶åœ¨0åˆ†æ‰§è¡Œï¼ˆUTCæ—¶é—´ï¼‰

jobs:
  fetch-open-issues:
    runs-on: ubuntu-latest
    permissions:
      issues: read    # æˆäºˆè¯»å–issueçš„æƒé™
      contents: write  # å¦‚æœéœ€è¦ä¸Šä¼ artifactéœ€è¦å†™æƒé™
    
    steps:
    - name: Fetch and process issues
      uses: actions/github-script@v6
      id: fetch-issues
      with:
        script: |
          const fs = require('fs');
          const { data: issues } = await github.rest.issues.listForRepo({
            owner: context.repo.owner,
            repo: context.repo.repo,
            state: 'open'
          });

          // è¿‡æ»¤æ‰Pull Requestï¼ˆGitHub APIè¿”å›çš„issuesåŒ…å«PRï¼‰
          const issuesOnly = issues.filter(issue => !issue.pull_request);
          
          // æ„é€ è¾“å‡ºå†…å®¹
          let output = `ğŸ“… æœªå…³é—­Issueç»Ÿè®¡ï¼ˆ${new Date().toUTCString()}ï¼‰\n\n`;
          issuesOnly.forEach(issue => {
            output += `ğŸ†” Issue #${issue.number}\n`;
            output += `ğŸ“› æ ‡é¢˜: ${issue.title}\n`;
            output += `ğŸ‘¤ æäº¤è€…: ${issue.user.login}\n`;
            output += `ğŸ“ å†…å®¹:\n${issue.body}\n`;
            output += `ğŸ”— é“¾æ¥: ${issue.html_url}\n`;
            output += 'â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•\n\n';
          });

          // å†™å…¥æ–‡ä»¶
          fs.writeFileSync('open-issues.txt', output);
          
          // è¾“å‡ºåˆ°æ§åˆ¶å°
          console.log(output);

          // è®¾ç½®è¾“å‡ºå˜é‡ä¾›åç»­æ­¥éª¤ä½¿ç”¨
          return output;

    - name: Upload issues as artifact
      uses: actions/upload-artifact@v3
      with:
        name: open-issues-report
        path: |
          open-issues.txt
